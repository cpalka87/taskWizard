<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="bootstrap.min.css">
    <link rel="stylesheet" href="stylesheet.css">
    <script src="lib.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  </head>
<body>
 <script>
  function variantBuilder() {
    var productUrl = document.getElementById('site-url').value;
    productUrl = productUrl.split('/');
    var domain = productUrl[2]
    var handle = productUrl[productUrl.length - 1];
    console.log(productUrl)
    console.log(domain)
    console.log(handle)
    $.getJSON(`https://${domain}/products.json`, function( data ) {  
      var regex = new RegExp(`\\b(\\w*${handle}\\w*)\\b`)
      var items = [];
      for (var product in data) {
        var currentProduct = data[product];
        for (var i = 0; i < currentProduct.length; i++) {
          for (var j = 0; j < currentProduct[i].variants.length; j++)
          if (currentProduct[i].handle.match(regex)) {
            
            items.push(currentProduct[i].variants[j].id)
          }
        }
        
      }
      console.log(items)
      $('#variant-output').text(items.join('\n'))
    });
  }
    </script>
    
<h1 id ="title">DonkWizard</h1>



<div class="container">
  <h2>Task Builder</h2>
  <form>
    <div class="form-group">
      <div class="row">
        <div class="col">
          <label for="site">Insert Site Name</label>
          <textarea class="form-control" id="site" rows="3" placeholder="Please enter site name exactly as it appears in task"></textarea>
        </div>
      </div>
    </div>
    <div class="form-group">
      <label for="mode">Select Mode</label>
      <select multiple class="form-control" id="mode">
        <option value="web">Safe</option>
        <option value="wallets">Fast</option>
        <option value="cbpup">Cyborg 3.0</option>
        <option value="cl">Checkout Link</option>
      </select>
    </div>
    <div class="form-group">
      <label for="variants">Variant Length</label>
      <textarea class="form-control" id="varlength" rows="3" placeholder="Please specify variant length"></textarea>
    </div>
    <div class="row">
      <div class="col button-submit">
        <button type="button" id="button-submit" class="btn-lg btn-primary" value="Submit" onclick="validateVarLength()">Submit</button>
      </div>
      <div class="col button-copy">
        <button type="button" id="button-copy" class="btn-lg btn-primary" onclick="clipBoard()">Copy</button>
        <div class="divider"></div>
        <button type="button" id="button-save" class="btn-lg btn-primary" onclick="validateOutput()">Download</button>
      </div>
    </div>
    <div class="form-row">
      <div class="col">
        <label for="variants">Variants:</label>
        <textarea class ="form-control" id="variants" rows="25" cols="50" placeholder="Paste Variants Here "></textarea> 
      </div>
      <div class="col">
        <label for="output">Output:</label>
        <textarea class="form-control" id="output" rows="25" cols="50" placeholder="Copy output and paste generated output into your .json file or download directly"></textarea> 
      </div>
    </div>
  </form>
</div>

<div class ="container">
  <h2>VariantBuilder</h2>
  <form>
    <div class="form-group">
      <div class="row">
        <div class="col">
          <label for="site-url">Insert product URL</label>
          <textarea class="form-control" id="site-url" rows="1" placeholder="Paste product URL here"></textarea>
        </div>
      </div>
    </div>
    <div class="form-group">
      <div class="row">
        <div class="col">
          <label for="variant-output">Copy variants below</label>
          <textarea class="form-control" id="variant-output" rows="15"></textarea>
        </div>
      </div>
    </div>
    <div class="col button-url-submit">
      <button type="button" id="button-url-submit" class="btn-lg btn-primary" value="Submit" onclick="variantBuilder()">Submit</button>
    </div>
  </form>
</div>


</body>
</html>
